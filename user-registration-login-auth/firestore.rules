{
  "rules_version": "2",
  "service": "cloud.firestore",
  "match": {
    "/databases/{database}/documents": {
      "comment": "Users collection - users can only read/write their own data",
      "match /users/{userId}": {
        "allow read": "if request.auth != null && request.auth.uid == userId",
        "allow create": "if request.auth != null && request.auth.uid == userId",
        "allow update": "if request.auth != null && request.auth.uid == userId",
        "allow delete": "if request.auth != null && request.auth.uid == userId"
      },
      "comment2": "Carts collection - users can only access their own cart",
      "match /carts/{cartId}": {
        "allow read": "if request.auth != null && resource.data.userId == request.auth.uid",
        "allow create": "if request.auth != null && request.resource.data.userId == request.auth.uid",
        "allow update": "if request.auth != null && resource.data.userId == request.auth.uid",
        "allow delete": "if request.auth != null && resource.data.userId == request.auth.uid"
      },
      "comment3": "Orders collection - users can only access their own orders",
      "match /orders/{orderId}": {
        "allow read": "if request.auth != null && resource.data.userId == request.auth.uid",
        "allow create": "if request.auth != null && request.resource.data.userId == request.auth.uid",
        "allow update": "if request.auth != null && resource.data.userId == request.auth.uid"
      },
      "comment4": "Items collection - read only for authenticated users",
      "match /items/{itemId}": {
        "allow read": "if request.auth != null",
        "allow write": "if false"
      },
      "comment5": "Deny all other access by default",
      "match /{document=**}": {
        "allow read, write": "if false"
      }
    }
  }
}
